<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{include/schedule_layout}">
<head>
	<!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet">
    <!-- FullCalendar JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <!-- Custom CSS -->
    <link href="/dist/css/style.min.css" rel="stylesheet">
    <style>
		.bordered {
		    table-layout: fixed; /* 테이블 레이아웃을 고정으로 설정 */
		    width: 100%; /* 테이블 너비를 100%로 설정 */
		}
		
		.bordered td {
		    height: 71px; /* 모든 셀의 높이를 동일하게 설정 */
		    vertical-align: middle; /* 수직 중앙 정렬 */
		    overflow: hidden; /* 내용이 넘칠 경우 숨기기 */
		}
    
    	/* 첫 번째 tr의 td와 th에서 상단 테두리 제거 */
		.bordered tbody tr:first-child th,
		.bordered tbody tr:first-child td {
		    border-top: none; /* 상단 테두리 제거 */
		}
			
		.bordered {
	  		border-left: 1px solid #e8eef3;
	  		border-right: 1px solid #e8eef3;
	  	}
	  	.bordered th,
	  	.bordered td {
	    	border-left: 1px solid #e8eef3;
	    	border-top: 1px solid #e8eef3;
	    	border-right: 1px solid #e8eef3;
	    }	
		
		/* 첫 번째 td를 수평 및 수직 가운데 정렬 */
		.bordered tbody tr td.align-center {
		    text-align: center; /* 수평 가운데 정렬 */
		    vertical-align: middle;
		    padding-bottom:8px;
		}
    	
    	.public-btn {
			width:72px;
			font-size:16px;
			height:45px;
		}
    	
    	.fc-timegrid-col-events{
    		margin:0px !important;
    	}
    
    	.fc-direction-ltr .fc-timegrid-slot-label-frame {
		    text-align: center;
		}
    	
		.fc .fc-timegrid-axis-frame,
		.fc .fc-timegrid-axis-cushion {
		    overflow: hidden !important;
		    display: flex !important;
		    align-items: center !important;  /* 수직 가운데 정렬 */
		    justify-content: center !important;  /* 수평 가운데 정렬 */
		    height: 100% !important;  /* 전체 높이 사용 */
		    white-space: nowrap;  /* 줄바꿈 방지 */
		}
		
    	.fc-timegrid-event-harness{
    		margin:0px !important;
    	}
    	
    	.form-control{
			margin-left:0px !important;
		}
		
		/* 반투명한 동그라미 스타일 */
		.fc-day-today .fc-daygrid-day-number {
			position: relative; /* 상대적 위치 설정 */
		}
		
		.fc-day-today{
			background-color:white !important;
		}
		  
		.fc-day-today .fc-daygrid-day-number::after {
			content: '';
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-48%, -50%);
			width: 23px; /* 원하는 동그라미 크기 */
			height: 23px; /* 원하는 동그라미 크기 */
			border-radius: 50%; /* 동그라미 모양 */
			background-color: #5f76e85d;
		}
		/* 종일 일정 높이 설정 */
		.fc-daygrid-event {
		    height: 20px !important; /* 원하는 높이로 조정 */
		    line-height: 20px !important; /* 텍스트가 중앙에 오도록 설정 */
		    display:flex;
		    align-items: center; /* 수직 가운데 정렬 */
		    justify-content: center; /* 가로 중앙 정렬 (필요 시) */
		    margin-left:0px !important;
		    margin-right:0px !important;
		}
		
		.fc-dayGridMonth-view .fc-event-title-container{
			height: 20px !important; /* 원하는 높이로 조정 */
		    line-height: 20px !important; /* 텍스트가 중앙에 오도록 설정 */
		}
		
		/* 시간 일정 높이 설정 */
		.fc-dayGridMonth-view .fc-timegrid-event {
		    height: 20px !important; /* 원하는 높이로 조정 */
		    line-height: 20px !important; /* 텍스트가 중앙에 오도록 설정 */
		}
				
    	.more-link-content:before {
			content: "\25BC"; /* 아래쪽 화살표 */
			margin-right: 5px; /* 아이콘과 숫자 간의 여백 */
			font-size: 12px; /* 아이콘 크기 */
			margin-left: 2px !important;
			margin-bottom: 1px !important;
			color: #212529;
		}
		  
		.more-link-content{
		  	color:#212529;
		 }
		 
		.fc-timeGridWeek-view .fc-timegrid-event{
		    align-items: center !important;  /* 수직 가운데 정렬 */
			padding:0px !important;
		}
		
		.fc-timeGridDay-view .fc-timegrid-event{
			padding:1px !important;
		}
		
		.fc-dayGridMonth-view .fc-daygrid-event{
			padding:1px !important;
		}
    	
    	.fc-event-title {
		    font-weight: normal !important; /* 제목 글씨를 일반 두께로 설정 */
		}
		
    	.fc-daygrid-event-dot {
		    border-width:7px;
		}
		
		.fc-dayGridMonth-view .fc-daygrid-event{
			margin-left:0px !important;
			margin-right:0px !important;
			margin-bottom:0px !important;
		}
		
		.fc-daygrid-day-bottom{
			padding-right:5px !important;
			padding-left:5px !important;
		}
    
    	.fc-header-toolbar{
    		margin-top:0px !important;
    		margin-bottom:0px !important;
    	}
    	
    	.fc-view{
    		margin-top:23px !important;
    	}
    
    	.holiday-number {
		    color: #FF0000 !important; /* 숫자 색상을 빨간색으로 설정 */
		}
		
    	.fc-holiday {
		    cursor: default !important;
		}
    
		/* 기본 버튼 스타일 */
		.fc-prev-button,
		.fc-next-button,
		.fc-today-button{
		    color: white !important;
		    background-color: #5f76e8 !important;
		    border: 1px solid white !important;
		    padding: 10px 20px !important;
		    font-size: 16px !important;
		    line-height: 1.5 !important;
		    border-radius: 2px !important;
		    transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out !important;
		}
		
		.fc-prev-button:hover,
		.fc-next-button:hover,
		.fc-today-button:hover,
		.fc-button-active:hover {
			background-color: #3e59e3 !important;
		}
		
		.fc-prev-button:focus,
		.fc-next-button:focus,
		.fc-today-button:focus,
		.fc-button-active:focus {
    		box-shadow: 0 0 0 0.2rem rgba(119, 139, 235, 0.5) !important;
    	}
    	
    	.fc-button-active{
    		color: white !important;
		    background-color: #5f76e8 !important;
		    border: 1px solid #5f76e8 !important;
		    padding: 10px 20px !important;
		    font-size: 16px !important;
		    line-height: 1.5 !important;
		    border-radius: 2px !important;
		    transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out !important;
    	}
    	
    	/* 기본 버튼 스타일 */
		#calendar .fc-dayGridMonth-button,
		#calendar .fc-timeGridWeek-button,
		#calendar .fc-timeGridDay-button{
		    color: #5f76e8;
		    background-color: transparent;
		    border: 1px solid #5f76e8;
		    padding: 10px 20px !important;
		    font-size: 16px !important;
		    line-height: 1.5 !important;
		    border-radius: 2px !important;
		    transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out !important;
		}
		
		#calendar .fc-dayGridMonth-button:hover,
		#calendar .fc-timeGridWeek-button:hover,
		#calendar .fc-timeGridDay-button:hover {
			color: #fff !important;
		    background-color: #5f76e8;
		    border-color: #5f76e8;
		}
		
		#calendar .fc-dayGridMonth-button:focus,
		#calendar .fc-timeGridWeek-button:focus,
		#calendar .fc-timeGridDay-button:focus {
    		box-shadow: 0 0 0 0.2rem rgba(95, 118, 232, 0.5);
    	}
		
    	body{
    		color:#212529 !important;
    	}
		
		/* 일요일 헤더 및 셀 글씨 색상 */
		.fc-sunday .fc-daygrid-day-number {
		    color: #FF0000 !important; /* 일요일 글씨 색상 */
		}
		
		/* 토요일 헤더 및 셀 글씨 색상 */
		.fc-saturday .fc-daygrid-day-number {
		    color: #0031AE !important; /* 토요일 글씨 색상 */
		}

    	/* 일요일 셀 배경색 */
		.fc-sunday {
		    background-color: #FFF8F8 !important; /* 연한 빨간색 배경 */
		}
		
		/* 토요일 셀 배경색 */
		.fc-saturday {
		    background-color: #F4FBFF !important; /* 연한 파란색 배경 */
		}
		
		.fc-scrollgrid-sync-inner {
		    height: 100%; /* 전체 캘린더 높이 */
		}
		
		.swal-custom-button {
			background-color: #5f76e8 !important;
			color: white; /* 버튼 텍스트 색상 */
			border: none; /* 버튼 테두리 제거 */
			padding: 10px 20px; /* 버튼 패딩 */
			font-size: 16px; /* 버튼 폰트 크기 */
			cursor: pointer; /* 마우스 커서 포인터 */
		}
		
		.swal-custom-button:hover {
		  background-color: #3e59e3 !important;
		}
		
		.list-group-item{
			border: none;
			text-align: center;
			font-size:18px;
			margin-bottom:0px !important;
		}

	    .btn-group-custom{
	    	width:215px;
	    	height:46px;
	    }
	    
	    .scrollable-list {
	        max-height: calc(100% - 100px); /* ul의 최대 높이를 등록 버튼 위까지로 설정 */
	        overflow-y: auto; /* 수직 스크롤바 추가 */
		    margin-bottom: 60px; /* 하단 마진 */
	        padding-right: 10px; /* 스크롤바와 내용 간의 간격 */
	    }
	    
	    /* 스크롤바 스타일링 */
		.scrollable-list::-webkit-scrollbar {
		    width: 20px; /* 스크롤바의 너비 */
		    padding-bottom:20px;
		}
		
		/* 스크롤바 트랙 스타일링 */
		.scrollable-list::-webkit-scrollbar-track {
		    margin-top:10px;
		}
		
		/* 스크롤바 손잡이(thumb) 스타일링 */
		.scrollable-list::-webkit-scrollbar-thumb {
		    background-color: #ccc; /* 스크롤바 손잡이 색상 */
		    border-radius: 10px; /* 손잡이 전체를 둥글게 */
		    border: 3px solid transparent; /* 내부 여백과 배경색 유지 */
		    background-clip: padding-box; /* 내부 여백 유지 */
		}
	    
	    /* 버튼 활성화 스타일 (Bootstrap의 기본 버튼 스타일 사용) */
		.btn-group-custom .btn.active {
		    background-color: #007bff;
		    color: white;
		}
		
	</style>
</head>
<th:block layout:fragment="content">
<body>
	<div class="page-wrapper">
		<div class="container-fluid" style="margin-bottom:-10px;">
			<div class="row">
			    <div class="col-12">
			        <div class="card">
			            <div class="card-body" style="padding:50px 80px">
			                <!-- "범주관리" 타이틀과 하단 선 -->
			                <div class="row" style="margin-left:0px !important; margin-right:0px !important; border-bottom: 1px solid gray; padding-bottom: 20px; display:flex; align-items: center;">
			                    <div class="col d-flex justify-content-start align-items-center" style="padding:0px; max-width:140px; ">
			                        <div style="font-size:30px;">일정관리</div>
			                    </div>
			                    <!-- 공용/개인 선택 버튼 -->
					            <div class="btn-group btn-group-custom" role="group" aria-label="범주 유형 선택" style="margin-right: 10px;">
								    <button type="button" class="btn btn-outline-primary active" id="total-button" onclick="showTotalCategories()">전체</button>
								    <button type="button" class="btn btn-outline-primary" id="public-button" onclick="showPublicCategories()">공용</button>
								    <button type="button" class="btn btn-outline-primary" id="private-button" onclick="showPrivateCategories()">개인</button>
								</div>
								<div class="col d-flex justify-content-end align-items-center" style="padding:0px;">
									<button type="button" class="btn btn-outline-secondary public-btn" id="register-button" onclick="createSchedule()"
									data-toggle="modal" data-target="#scheduleCreateModal">등록</button>
								</div>
			                </div>
			                
			                <!-- 좌측 네모난 div와 오른쪽 콘텐츠를 같은 행에 배치 -->
			                <div class="row mt-4" style="margin-left:0px !important; margin-right:0px !important;">
			                    <!-- 좌측 네모난 div -->
			                    <div class="col" style="max-width: 300px; padding-left:0px !important;">
			                        <div style="border: 1px solid gray; height: calc(100vh - 330px); min-height: 200px; border-radius:10px; position: relative;">
			                        	<!-- 범주목록 타이틀 -->
			                            <div style="font-size: 22px; border-bottom: 1px solid gray; text-align: center;
			                            display: flex; align-items: center; justify-content: center; height: 80px; background-color:#E8EAEC;
			                            border-top-left-radius: 10px; border-top-right-radius: 10px; color:black;">
			                                범주목록
			                            </div>
			                            
			                            <!-- 전체 범주 목록 -->
										<ul id="total-category-list" class="list-group scrollable-list" style="list-style: none; padding: 20px; ">
										    <li class="list-group-item" style="display:flex; align-items: center;">
										        <div style="width:20px; height:20px; border-radius:5px; background-color: #D7EEFF; margin-right: 10px;"></div>
										        <div>공용</div>
										    </li>
										    <li class="list-group-item" style="display:flex; align-items: center;">
										        <div style="width:20px; height:20px; border-radius:5px; background-color: #E5DCFF; margin-right: 10px;"></div>
										        <div>개인</div>
										    </li>
										</ul>
			                            
			                            <!-- 공용 범주 목록 -->
										<ul id="public-category-list" class="list-group scrollable-list" style="list-style: none; padding: 20px;">
										    <li th:each="category : ${publicCategoryList}" class="list-group-item"
										        style="display:flex; align-items: center;">
										        <div th:style="'width: 20px; height: 20px; border-radius:5px; background-color: #' + ${category.category_color} + '; margin-right: 10px;'"></div>
										        <div th:text="${category.category_name}"></div>
										    </li>
										</ul>
										
										<!-- 개인 범주 목록 -->
										<ul id="private-category-list" class="list-group scrollable-list" style="list-style: none; padding: 20px; display: none;"> <!-- 처음에는 숨김 -->
										    <li th:each="category : ${privateCategoryList}" class="list-group-item"
										        style="display:flex; align-items: center;">
										        <div th:style="'width: 20px; height: 20px; border-radius:5px; background-color: #' + ${category.category_color} + '; margin-right: 10px;'"></div>
										        <div th:text="${category.category_name}"></div>
										    </li>
										</ul>
			                        </div>
			                    </div>
			                    <!-- 우측 테이블 컨텐츠 -->
								<div class="col" style="padding-right: 0;"> <!-- 오른쪽 패딩 조정 -->
									<div id="calendar"></div>
								</div>
				            </div>
				        	<!-- 등록 모달 HTML -->
							<div class="modal fade" id="scheduleCreateModal" tabindex="-1" role="dialog" aria-labelledby="scheduleCreateModalLabel">
							    <div class="modal-dialog modal-dialog-centered custom-modal-size" style="max-width:50%; width: 50%; height: 80vh;">
							        <div class="modal-content">
							            <div class="modal-header modal-colored-header bg-primary" style="display: flex; align-items: center; justify-content: space-between; font-size: 25px;">
							                <div class="modal-title" id="scheduleCreateModalLabel">일정 등록</div>
							                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							            </div>
							    			<form id="scheduleCreateFrm">
									            <div class="modal-body" style="padding:0px;">
									    			<input type="hidden" id="csrf_token" th:value="${_csrf.token}">
									                <table style="border-bottom:none; border-top:none;" class="table bordered">
									                    <tbody id="scheduleCreateContent">
									                        <!-- 날짜 선택 -->
												            <tr>
												                <td class="align-center" style="width: 20%;">
												                    <label>기간</label>
												                </td>
												                <td style="width: 80%;">
												                    <div class="form-inline">
												                        <input type="radio" name="is_period" value="N" id="createDateOption1" checked>
			                                                            <label for="createDateOption1" class="ml-2">하루</label>
			                                                            <input type="date" class="form-control" id="create_single_date" name="start_date" placeholder="날짜" style="margin-left: 15px !important;">
			                                                            <input type="radio" name="is_period" value="Y" id="createDateOption2" class="ml-4">
			                                                            <label for="createDateOption2" class="ml-2">기간</label>
			                                                            <input type="date" class="form-control" id="create_period_start_date" name="start_date" placeholder="시작일" style="margin-left: 15px !important;">
			                                                            <span class="ml-3 mr-2"> ~ </span>
			                                                            <input type="date" class="form-control" id="create_period_end_date" name="end_date" placeholder="종료일" style="margin-left: 10px !important">
												                    </div>
												                </td>
												            </tr>
												
												            <!-- 휴일명 입력 -->
												            <tr>
												                <td class="align-center" style="width: 20%;">
												                    <label>휴일명</label>
												                </td>
												                <td style="width: 80%;">
												                    <input type="text" class="form-control" name="holiday_name" id="create_holiday_name" placeholder="휴일명">
												                </td>
												            </tr>
												
												            <!-- 매년반복여부 -->
												            <tr>
												                <td class="align-center" style="width: 20%;">
												                    <label>매년반복여부</label>
												                </td>
												                <td style="width: 80%;">
												                    <div class="form-inline">
																		<input type="radio" name="repeat_type" value="NONE" id="create_repeatOption1" checked>
													                    <label for="repeatOption1" class="ml-2">반복 없음</label>
													                    <input type="radio" name="repeat_type" value="YEARLY" id="create_repeatOption2" class="ml-4">
													                    <label for="repeatOption2" class="ml-2">매년 반복</label>
												                    </div>
												                </td>
												            </tr>
												            <tr>
												            </tr>
									                    </tbody>
									                </table>
									            </div>
									            <div class="modal-footer" style="margin-top:-15px;">
									                <button type="button" class="btn waves-effect waves-light btn-outline-secondary public-btn" data-dismiss="modal">취소</button>
						             				<button type="submit" class="btn waves-effect waves-light btn-primary public-btn">등록</button>
									            </div>
							        	</form>
							        </div>
							    </div>
							</div>
				        </div>
				    </div>
				</div>
			</div>
        </div>
	</div>
	<script src="/assets/libs/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="/assets/libs/popper.js/dist/umd/popper.min.js"></script>
    <script src="/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- apps -->
    <!-- apps -->
    <script src="/dist/js/app-style-switcher.js"></script>
    <script src="/dist/js/feather.min.js"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
    <script src="/assets/extra-libs/sparkline/sparkline.js"></script>
    <!--Menu sidebar -->
    <script src="/dist/js/sidebarmenu.js"></script>
    <!--Custom JavaScript -->
    <script src="/dist/js/custom.min.js"></script>
    
<script>
	// 전역 변수로 현재 범주 유형 설정
	let currentCategoryType = 0; // 기본값: 전체 (0)
	
	// 새로고침 시 항상 "전체"로 설정되도록 수정
	localStorage.setItem('currentCategoryType', currentCategoryType); // 초기화 시 "전체" 설정으로 저장
	
	// 범주 목록 및 캘린더 데이터 로드 함수
	function updateCategoryAndCalendar() {
	    if (currentCategoryType === 0) {
	        showTotalCategories(); // 전체 범주와 일정 데이터 로드
	    } else if (currentCategoryType === 1) {
	        showPublicCategories(); // 공용 범주와 일정 데이터 로드
	    } else {
	        showPrivateCategories(); // 개인 범주와 일정 데이터 로드
	    }
	}
	
	// 전체 범주 목록 표시 함수
	window.showTotalCategories = function () {
	    // 전체 범주를 보이게 하고, 공용과 개인 범주는 숨김
	    document.getElementById('total-category-list').style.display = 'block';
	    document.getElementById('public-category-list').style.display = 'none';
	    document.getElementById('private-category-list').style.display = 'none';
	
	    // 버튼 상태 업데이트
	    document.getElementById('total-button').classList.add('active');
	    document.getElementById('public-button').classList.remove('active');
	    document.getElementById('private-button').classList.remove('active');
	
	    // 현재 범주 유형 설정: 전체
	    currentCategoryType = 0;
	
	    // 로컬 스토리지에 저장
	    localStorage.setItem('currentCategoryType', currentCategoryType);
	
	    // 전체 일정 데이터 로드
	    loadCalendarData('/getTotalScheduleData');
	};
	
	// 공용 범주 목록 표시 함수
	window.showPublicCategories = function () {
	    // 공용 범주를 보이게 하고, 전체와 개인 범주는 숨김
	    document.getElementById('total-category-list').style.display = 'none';
	    document.getElementById('public-category-list').style.display = 'block';
	    document.getElementById('private-category-list').style.display = 'none';
	
	    // 버튼 상태 업데이트
	    document.getElementById('total-button').classList.remove('active');
	    document.getElementById('public-button').classList.add('active');
	    document.getElementById('private-button').classList.remove('active');
	
	    // 현재 범주 유형 설정: 공용
	    currentCategoryType = 1;
	
	    // 로컬 스토리지에 저장
	    localStorage.setItem('currentCategoryType', currentCategoryType);
	
	    // 공용 일정 데이터 로드
	    loadCalendarData('/getPublicScheduleData');
	};
	
	// 개인 범주 목록 표시 함수
	window.showPrivateCategories = function () {
	    // 개인 범주를 보이게 하고, 전체와 공용 범주는 숨김
	    document.getElementById('total-category-list').style.display = 'none';
	    document.getElementById('public-category-list').style.display = 'none';
	    document.getElementById('private-category-list').style.display = 'block';
	
	    // 버튼 상태 업데이트
	    document.getElementById('total-button').classList.remove('active');
	    document.getElementById('public-button').classList.remove('active');
	    document.getElementById('private-button').classList.add('active');
	
	    // 현재 범주 유형 설정: 개인
	    currentCategoryType = 2;
	
	    // 로컬 스토리지에 저장
	    localStorage.setItem('currentCategoryType', currentCategoryType);
	
	    // 개인 일정 데이터 로드
	    loadCalendarData('/getPrivateScheduleData');
	};
	
	$(document).ready(function () {
	    // 페이지 로드 시 항상 "전체" 버튼 클릭 상태로 초기화
	    currentCategoryType = 0;
	    updateCategoryAndCalendar(); // 전체 범주와 일정 데이터 로드
	});
</script>

<script>
    // FullCalendar 초기화 함수
    function initFullCalendar(eventsData) {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            timeZone: 'local', // 타임존을 'local'로 설정
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: { // 버튼 텍스트를 사용자 정의
                today: '오늘',
                month: '월간',
                week: '주간',
                day: '일간',
                prev: '이전',
                next: '다음'
            },
            titleFormat: function (date) { // 커스텀 titleFormat 설정
                return date.date.year + '년 ' + (date.date.month + 1) + '월';
            },
            dayCellDidMount: function (arg) { // 날짜 셀이 렌더링된 후 호출
                const today = new Date(); // 오늘 날짜
                if (
                    arg.date.getDate() === today.getDate() &&
                    arg.date.getMonth() === today.getMonth() &&
                    arg.date.getFullYear() === today.getFullYear()
                ) {
                    // 오늘 날짜 셀에 클래스를 추가
                    arg.el.classList.add('fc-day-today');
                }
            },
            events: eventsData, // 전달된 이벤트 데이터로 초기화
            editable: true, // 전체적으로 일정 수정 가능
            eventStartEditable: true, // 드래그로 시작 시간 변경 가능
            eventDurationEditable: true, // 드래그로 일정 길이 변경 가능
            forceEventDuration: true, // 이벤트의 기간을 강제로 적용
            eventAllow: function (dropInfo, draggedEvent) {
                // 휴일 이벤트는 드래그할 수 없도록 설정
                if (draggedEvent.classNames.includes('fc-holiday')) {
                    return false; // 드래그 불가
                }
                return true; // 다른 일정은 드래그 가능
            },
            droppable: true,
            selectable: true, // 일정 선택 가능
            height: 'calc(100vh - 330px)',  // 높이를 자동으로 조정
            dayMaxEvents: true,  // 각 셀의 최대 이벤트 수를 제한
            dayMaxEventRows: 2,  // 각 셀의 최대 이벤트 행 수 설정
            moreLinkContent: function (args) { // "more" 링크의 내용 커스터마이징
                // 더보기 링크를 감싸는 span 생성
                let moreLinkSpan = document.createElement('span');
                moreLinkSpan.className = 'more-link-content';
                moreLinkSpan.textContent = `${args.num}`; // 더 많은 일정의 개수 표시

                return { domNodes: [moreLinkSpan] };
            },
            dayHeaderClassNames: function (arg) { // 헤더 부분의 특정 요일에 클래스를 추가
                if (arg.date.getDay() === 0) {
                    return ['fc-sunday-header'];
                } else if (arg.date.getDay() === 6) {
                    return ['fc-saturday-header'];
                }
            },
            dayCellClassNames: function (arg) { // 특정 요일에 클래스를 추가
                if (arg.date.getDay() === 0) {
                    return ['fc-sunday'];
                } else if (arg.date.getDay() === 6) {
                    return ['fc-saturday'];
                }
            },
            dayCellContent: function (e) { // 날짜 셀의 숫자만 표시되도록 설정
                e.dayNumberText = e.date.getDate(); // '1일' 대신 '1'만 표시
            },
            eventDidMount: function () { // 이벤트가 마운트될 때
                addHolidayClassToDateNumbers(); // 각 이벤트 렌더링 후 호출하여 날짜 셀에 클래스 추가
            }
        });

        calendar.render(); // 캘린더 렌더링
    }

    // 일정 데이터 로드 및 FullCalendar 업데이트 함수
    function loadCalendarData(scheduleApiUrl) {
        // 공휴일 데이터는 항상 동일하게 로드
        fetch('/getHolidayData') // 공휴일 데이터 로드
            .then(response => response.json())
            .then(holidayData => {
                const holidayEvents = holidayData.flatMap(holiday => {
                    // 기본 이벤트 객체
                    let event = {
                        title: holiday.holiday_name,
                        start: holiday.start_date,
                        end: holiday.is_period === 'Y' ? new Date(new Date(holiday.end_date).setDate(new Date(holiday.end_date).getDate() + 1)).toISOString().split('T')[0] : holiday.start_date, // 종료일을 다음 날로 설정
                        classNames: ['fc-holiday'],
                        allDay: true,
                        backgroundColor: '#FFF8F8',
                        textColor: '#FF0000',
                        editable: false // 휴일 이벤트는 드래그 불가하도록 설정
                    };

                    // 반복 타입이 YEARLY라면 매년 반복 이벤트 생성
                    if (holiday.repeat_type === 'YEARLY') {
                        return createYearlyEvents(holiday);
                    } else {
                        return [event]; // 반복이 없을 경우 기본 이벤트만 반환
                    }
                });

                // 일정 데이터 로드 (동적으로 변경됨)
                fetch(scheduleApiUrl)
                    .then(response => response.json())
                    .then(scheduleData => {
                        const scheduleEvents = scheduleData.flatMap(schedule => {
                            // 반복 타입에 따른 이벤트 생성
                            switch (schedule.repeat_type) {
                                case 'DAILY':
                                    return createRepeatedEvents(schedule, 'DAILY', scheduleApiUrl);
                                case 'WEEKLY':
                                    return createRepeatedEvents(schedule, 'WEEKLY', scheduleApiUrl);
                                case 'MONTHLY':
                                    return createRepeatedEvents(schedule, 'MONTHLY', scheduleApiUrl);
                                case 'YEARLY':
                                    return createRepeatedEvents(schedule, 'YEARLY', scheduleApiUrl);
                                default:
                                	// 반복이 없는 기본 이벤트 생성
                                    const startDate = new Date(schedule.start_time);
                                    const endDate = new Date(schedule.end_time);
                                    
                                    // 날짜 부분만 추출하여 isAllDayEvent를 결정
                                    const startDateOnly = new Date(startDate.toISOString().split('T')[0]); // 시간 제거
                                    const endDateOnly = new Date(endDate.toISOString().split('T')[0]); // 시간 제거

                                    // 자정 기준으로 시작일과 종료일의 날짜만 비교하여 종일 이벤트 여부 결정
                                    const isAllDayEvent = schedule.is_all_day === 'Y' || 
                                                          (startDate.getHours() === 0 && startDate.getMinutes() === 0 &&
                                                           endDate.getHours() === 0 && endDate.getMinutes() === 0 &&
                                                           startDate < endDate); // 시작일이 종료일보다 앞선 경우

                                    let eventStart, eventEnd; // 이벤트의 start와 end 값을 설정할 변수

                                    if (isAllDayEvent) {
                                        // allDay 이벤트인 경우, 종료 날짜를 다음 날로 설정하고 시간을 제거
                                        startDateOnly.setDate(startDateOnly.getDate() + 1);
                                        endDateOnly.setDate(endDateOnly.getDate() + 1); // 종료 날짜를 다음 날로 설정
                                        eventStart = startDateOnly.toISOString().split('T')[0]; // 날짜만 사용
                                        eventEnd = endDateOnly.toISOString().split('T')[0]; // 날짜만 사용
                                    } else {
                                        // 시간 기반 이벤트의 경우 원래의 start와 end 값을 사용
                                        eventStart = startDate.toISOString(); // 원래 시작 시간 사용
                                        eventEnd = endDate.toISOString(); // 원래 종료 시간 사용
                                    }

                                 	// 디버깅: 콘솔에 이벤트 정보 출력
                                    console.log({
                                        title: schedule.schedule_title,
                                        start: eventStart, // 설정된 시작 시간 (날짜 또는 시간 포함)
                                        end: eventEnd, // 설정된 종료 시간 (날짜 또는 시간 포함)
                                        allDay: isAllDayEvent,
                                    });
                                    
                                    // backgroundColor 설정
                                    let backgroundColor;
                                    if (scheduleApiUrl === '/getTotalScheduleData') { // 전체 버튼
                                        backgroundColor = schedule.calendar_type === 0 ? '#D7EEFF' : '#E5DCFF';
                                    } else { // 공용, 개인 버튼
                                        backgroundColor = `#${schedule.category_color}`;
                                    }

                                    return [{
                                        title: schedule.schedule_title,
                                        start: eventStart, // 설정된 시작 시간 (날짜 또는 시간 포함)
                                        end: eventEnd, // 설정된 종료 시간 (날짜 또는 시간 포함)
                                        allDay: isAllDayEvent, // 날짜 차이에 따라 종일 일정 여부 결정
                                        backgroundColor: backgroundColor, // 배경색 설정
                                        textColor: 'black',
                                        editable: true, // 드래그 가능
                                        classNames: ['fc-schedule'] // 일정 클래스 추가
                                    }];
                            }
                        });

                        // 두 이벤트 데이터를 합쳐서 FullCalendar에 전달
                        initFullCalendar([...holidayEvents, ...scheduleEvents]);
                        addHolidayClassToDateNumbers(); // 공휴일 날짜 셀에 클래스 추가
                    })
                    .catch(error => console.error('Error loading schedule data:', error));
            })
            .catch(error => console.error('Error loading holiday data:', error));
    }

    // 반복 이벤트 생성 함수
    function createRepeatedEvents(schedule, repeatType, scheduleApiUrl) {
        const events = [];
        const start = new Date(schedule.start_time);
        const end = new Date(schedule.end_time);
        const repeatStartDate = new Date(schedule.repeat_start_date);
        const repeatEndDate = new Date(schedule.repeat_end_date);

        let currentStartDate = new Date(repeatStartDate);
        let currentEndDate = new Date(currentStartDate.getTime() + (end - start)); // 동일한 간격 유지
        
        // backgroundColor 설정
        let backgroundColor;
        if (scheduleApiUrl === '/getTotalScheduleData') { // 전체 버튼
            backgroundColor = schedule.calendar_type === 0 ? '#D7EEFF' : '#E5DCFF';
        } else { // 공용, 개인 버튼
            backgroundColor = `#${schedule.category_color}`;
        }

        while (currentStartDate <= repeatEndDate) {
            events.push({
                title: schedule.schedule_title,
                start: currentStartDate.toISOString(),
                end: currentEndDate.toISOString(),
                classNames: ['fc-schedule'],
                allDay: schedule.is_all_day === 'Y' ? true : false,
                backgroundColor: backgroundColor,
                textColor: 'black',
                editable: true
            });

            // 반복 유형에 따라 다음 반복 날짜 계산
            switch (repeatType) {
                case 'DAILY':
                    currentStartDate.setDate(currentStartDate.getDate() + 1); // 하루 증가
                    currentEndDate.setDate(currentEndDate.getDate() + 1);
                    break;
                case 'WEEKLY':
                    currentStartDate.setDate(currentStartDate.getDate() + 7); // 1주일 증가
                    currentEndDate.setDate(currentEndDate.getDate() + 7);
                    break;
                case 'MONTHLY':
                    currentStartDate.setMonth(currentStartDate.getMonth() + 1); // 1달 증가
                    currentEndDate.setMonth(currentEndDate.getMonth() + 1);
                    break;
                case 'YEARLY':
                    currentStartDate.setFullYear(currentStartDate.getFullYear() + 1); // 1년 증가
                    currentEndDate.setFullYear(currentEndDate.getFullYear() + 1);
                    break;
            }
        }

        return events;
    }

    // 매년 반복 이벤트 생성 함수
    function createYearlyEvents(holiday) {
        const events = [];
        const startYear = new Date().getFullYear(); // 현재 연도
        const endYear = startYear + 10; // 10년간 반복 예시

        for (let year = startYear; year <= endYear; year++) {
            const startDate = new Date(holiday.start_date);
            const endDate = holiday.is_period === 'Y' ? new Date(holiday.end_date) : startDate;

            // 시작일과 종료일의 연도를 현재 반복하는 연도로 설정
            startDate.setFullYear(year);
            endDate.setFullYear(year);

            events.push({
                title: holiday.holiday_name, // 공휴일 이름
                start: startDate.toISOString().split('T')[0], // ISO 포맷으로 변환
                end: endDate.toISOString().split('T')[0],
                classNames: ['fc-holiday'], // 공휴일 클래스 추가
                allDay: holiday.is_period === 'N' ? true : false,
                backgroundColor: '#FFF8F8',
                textColor: '#FF0000',
                editable: false // 휴일 이벤트는 드래그 불가하도록 설정
            });
        }

        return events;
    }

    // 공휴일 날짜 셀의 숫자에 클래스를 추가하는 함수
    function addHolidayClassToDateNumbers() {
        const holidayEvents = document.querySelectorAll('.fc-h-event.fc-holiday'); // 공휴일 이벤트만 선택
        holidayEvents.forEach(eventEl => {
            const dayCell = eventEl.closest('.fc-daygrid-day'); // fc-h-event의 조상 중에서 fc-daygrid-day 찾기
            if (dayCell) {
                const dayNumber = dayCell.querySelector('.fc-daygrid-day-number'); // fc-daygrid-day 안에 있는 fc-daygrid-day-number 찾기
                if (dayNumber) {
                    dayNumber.classList.add('holiday-number'); // 클래스 추가
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateCategoryAndCalendar(); // 초기 로드 시 전체 일정 데이터 로드 및 범주 목록 설정
        window.dispatchEvent(new Event('resize')); // 캘린더 초기화 후 리사이즈 이벤트 강제 발생
    });
</script>

</th:block>
</body>
</html>