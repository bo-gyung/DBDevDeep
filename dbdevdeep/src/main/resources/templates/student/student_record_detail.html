<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{include/student_layout}">
<head>
	<link href="/dist/css/style.min.css" rel="stylesheet">

<style>
div.dataTables_wrapper div.dataTables_paginate ul.pagination {
	margin: 2px 0;
	white-space: nowrap;
	justify-content: center;
}

table {
	font-size: 12px;
}

</style>
</head>
<th:block layout:fragment="content">
<div class="page-wrapper">
	<div class="page-breadcrumb">
		<div class="row">
			<div class="col-7 align-self-center">
				<div class="d-flex align-items-center">
					<nav aria-label="breadcrumb">
					</nav>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row">
			<div class="col-12">
				<div class="card" style="padding: 50px 80px;">
					<div class="card-body">
						<div class="row d-flex justify-content-between" style="margin-left:0px !important; margin-right:0px !important;">
							<div class="d-flex justify-content-start align-items-center" style="padding-left:0px; max-width:260px;">
		                        <div style="font-size:30px; color:black;">생활기록부</div>
		                    </div>
		                    <div class="d-flex justify-content-end align-items-center">
								<button id="download_pdf" class="btn btn-info">PDF로 받기</button>
							</div>	
						</div>
						<hr>
						<br>
						<div class="student-info">
							<div class="student-details">
							<input type="hidden" id="student_no" name="student_no" th:value="${dto.student_no}" />
								<div class="row">
									<div class="col-1"></div>
									<div class="col-2 justify-content-center align-items-center">
									    <th:block th:if="${dto.student_new_pic != null}">
									        <img th:src="@{'/UploadImg/student/' + ${dto.student_new_pic}}" width="150px" style="border-radius: 50%; object-fit: cover; aspect-ratio: 1 / 1;">
									    </th:block>
									</div>
									<div class="col-1"></div>
									<div class="col-8 justify-content-end align-items-center">
										<table class="table table-bordered no-wrap" style="font-size: 13px;">
											<colgroup>
												<col style="width: 20%">
												<col style="width: 80%">
											</colgroup>
											<tr>
												<th>이름</th>
												<td th:text="${dto.student_name}"></td>
											</tr>
											<tr>
												<th>생년월일</th>
												<td th:text="${dto.student_birth}"></td>
											</tr>
											<tr>
												<th>주소</th>
												<td th:text="${dto.student_addr}+${dto.student_detail_addr}+'('+${dto.student_post_code}+')'"></td>
											</tr>
											<tr>
												<th>전화번호</th>
												<td th:text="${dto.student_phone}"></td>
											</tr>
										</table>				    
									</div>
								</div>
								
								<div class="academic-info">
									<div class="row">
										<div class="col d-flex justify-content-between align-items-center">
											<div style="font-size:24px; color:black;">학년 이력 조회</div>
											<a th:href="@{/student/list/class/{std_no}(std_no=${dto.student_no})}" >학년 이력 수정</a>
										</div>
									</div>
									<table class="table table-hover table-bordered no-wrap mt-2" style="width:100%; font-size: 13px; text-align: center;">
										<colgroup>
											<col style="width: 20%">
											<col style="width: 20%">
											<col style="width: 20%">
											<col style="width: 20%">
											<col style="width: 20%">
										</colgroup>
										<thead>
											<tr>
												<th>학년도</th>
												<th>학년</th>
												<th>반</th>
												<th>번호</th>
												<th>담임 성명</th>
											</tr>
										</thead>
										<tbody>
											<th:block th:if="${#lists.isEmpty(cdto)}">
												<tr>
													<td colspan="5">학년 이력이 존재하지 않습니다.</td>
												</tr>
											</th:block>
											<th:block th:if="${!#lists.isEmpty(cdto)}">
												<tr th:each="studentClass : ${cdto}">
													<td th:text="${studentClass.teacher_history.getTYear()} + '년'"></td>
													<td th:text="${studentClass.teacher_history.getGrade()} + '학년'"></td>
													<td th:text="${studentClass.teacher_history.getGradeClass()} + '반'"></td>
													<td th:text="${studentClass.student_id} + '번'"></td>
													<td th:text="${studentClass.teacher_history.getEmployee().getEmpName()}"></td>
												</tr>
											</th:block>
										</tbody>
									</table>
								</div>

								<div class="academic-info mt-4">
								<div class="row">
									<div class="col d-flex justify-content-between align-items-center">
										<div style="font-size:24px; color:black;">가족사항</div>
										<a th:href="@{/student/list/parent/{std_no}(std_no=${dto.student_no})}">가족사항 수정</a>
									</div>
								</div>
									<table class="table table-hover table-bordered no-wrap mt-2" style="width:100%; font-size: 13px; text-align: center;">
										<colgroup>
											<col style="width: 10%">
											<col style="width: 15%">
											<col style="width: 40%">
											<col style="width: 35%">
										</colgroup>
										<thead>
											<tr>
												<th>관계</th>
												<th>성명</th>
												<th>연락처</th>
												<th>생년월일</th>
											</tr>
										</thead>
										<tbody>
											<th:block th:if="${#lists.isEmpty(pdto)}">
												<tr>
													<td colspan="4">학부모 정보가 존재하지 않습니다.</td>
												</tr>
											</th:block>
											<th:block th:if="${!#lists.isEmpty(pdto)}">
												<tr th:each="parentInfo : ${pdto}">
													<td th:text="${parentInfo.parent_relation}"></td>
													<td th:text="${parentInfo.parent_name}"></td>
													<td th:text="${parentInfo.parent_phone}"></td>
													<td th:text="${parentInfo.parent_birth}"></td>
												</tr>
											</th:block>
										</tbody>
									</table>
								</div>

								<div th:each="subject : ${subjectList}">
									<br>
									<div style="font-size:24px; color:black;" th:text="${subject.subject_name}"></div>
									<table class="table table-hover table-bordered no-wrap mt-2" style="font-size: 13px; width:100%; text-align: center; table-layout: fixed; overflow-x: auto;">
										<thead>
											<tr>
												<th rowspan="2">과목</th>
												<th th:each="curri : ${curriList}" th:if="${curri.subject.subjectNo == subject.subject_no}" th:text="${curri.curriculum_content}" colspan="3"></th>
												<th rowspan="2">취득 점수</th>
											</tr>
											<tr>
												<th:block th:each="curri : ${curriList}" th:if="${curri.subject.subjectNo == subject.subject_no}">
													<th style="padding: 16px 0px;">반영비율(%)</th>
													<th>과목만점</th>
													<th>점수</th>
												</th:block>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td th:text="${subject.subject_name}"></td>
												<th:block th:each="curri : ${curriList}" th:if="${curri.subject.subjectNo == subject.subject_no}">
													<td th:text="${curri.curriculum_ratio}"></td>
													<td th:text="${curri.curriculum_max_score}"></td>
													<td th:text="${scoreList.get(curri.curriculum_no) != null ? scoreList.get(curri.curriculum_no) : ''}"></td>
												</th:block>
												<td th:text="${totalScoreMap.get(subject.subject_no)}"></td>
											</tr>
											
										</tbody>
									</table>
								</div>
							</div>
							<div class="row">
								<div class="col d-flex justify-content-start">
								<button type="button" class="btn btn-outline-secondary m-1" 
			                            onclick="location.href='/student/record'">목록</button>
								</div>
								<div class="col d-flex justify-content-end align-items-center">
									<a th:onclick="studentDelete([[${dto.student_no}]])" class="btn waves-effect waves-light btn-light m-1">삭제</a>
									<a th:href="@{/student/list/update/{student_no}(student_no=${dto.student_no})}" class="btn waves-effect waves-light btn-primary m-1">수정</a><br>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				</div>
				</div>
			</div>
			<footer class="footer text-center text-muted"> All Rights Reserved by Adminmart. Designed by DBDevDeep and Developed by WrapPixel.</footer>
		</div>

		<script src="/assets/libs/jquery/dist/jquery.min.js"></script>
		<script src="/assets/libs/popper.js/dist/umd/popper.min.js"></script>
		<script src="/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="/dist/js/app-style-switcher.js"></script>
		<script src="/dist/js/feather.min.js"></script>
		<script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
		<script src="/assets/extra-libs/sparkline/sparkline.js"></script>
		<script src="/dist/js/sidebarmenu.js"></script>
		<script src="/dist/js/custom.min.js"></script>
		<script src="/assets/extra-libs/datatables.net/js/jquery.dataTables.min.js"></script>
		<script src="/dist/js/pages/datatable/datatable-basic.init.js"></script>

		<script>
		$(document).ready(function () {
			// PDF 다운로드 버튼 클릭 이벤트 처리
			$('#download_pdf').on('click', function () {
				// student_no 값을 가져와 URL에 추가
				const studentNo = document.getElementById("student_no").value;
				const url = '/student/pdf/' + studentNo;
				window.location.href = url;  // 해당 URL로 이동하여 PDF 다운로드
			});
		});
	</script>
	</th:block>
</html>
