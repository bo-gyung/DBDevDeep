<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{include/document_layout}">
<head>
    <!-- Custom CSS -->
    <link href="/assets/extra-libs/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet">
    <link href="/dist/css/style.min.css" rel="stylesheet">
    <style>
    	.swal-custom-button {
		  background-color: #5f76e8 !important;
		  color: white; /* 버튼 텍스트 색상 */
		  border: none; /* 버튼 테두리 제거 */
		  padding: 10px 20px; /* 버튼 패딩 */
		  font-size: 16px; /* 버튼 폰트 크기 */
		  cursor: pointer; /* 마우스 커서 포인터 */
		}
		
		.swal-custom-button:hover {
		  background-color: #3e59e3 !important;
		}
		
    	body{
    		color:#212529 !important;
    	}
    	
    	.public-btn{
    		width:200px !important;
    		border-radius:25px;
    		font-size:24px;
    		line-height:50px;
    	}
    	
		input[type="checkbox"] {
            width: 12px; /* 너비 설정 */
            height: 12px; /* 높이 설정 */
            transform: scale(1.5); /* 크기 조정 비율 */
            -webkit-transform: scale(1.5); /* 크로스 브라우저 호환성 */
            -moz-transform: scale(1.5); /* 크로스 브라우저 호환성 */
            -ms-transform: scale(1.5); /* 크로스 브라우저 호환성 */
            -o-transform: scale(1.5); /* 크로스 브라우저 호환성 */
            margin: 5px; /* 여백 설정 */
		}
		
		/* 두 번째, 세 번째, 네 번째 th 요소에 오른쪽 패딩을 추가 */
		#holiday_config th:nth-child(2),
		#holiday_config th:nth-child(3),
		#holiday_config th:nth-child(4) {
		    padding-right: 20px; /* 필요한 만큼의 오른쪽 패딩 추가 */
		}
		
		div.dataTables_wrapper div.dataTables_paginate ul.pagination {
		  white-space: nowrap;
		  justify-content: center;
		  margin-top:25px;
		}
	
		/* DataTables 검색 영역을 Flexbox로 설정하여 수평 및 수직 정렬 */
		div.dataTables_wrapper div.dataTables_filter {
		  display: flex; /* Flexbox 사용 */
		  align-items: center; /* 수직 가운데 정렬 */
		  justify-content: flex-end; /* 오른쪽 정렬 */
		  margin-bottom: 0; /* 하단 여백 제거 */
		}
		
		/* 검색 input 필드 스타일 */
		div.dataTables_wrapper div.dataTables_filter input {
		  margin-left: 0.5em; /* 왼쪽 여백 추가 */
		  display: inline-block; /* 인라인 블록 설정 */
		  width: auto; /* 너비 자동 설정 */
		  height: 30px; /* input 높이 설정 */
		  vertical-align: middle; /* 수직 정렬 */
		  box-sizing: border-box; /* 박스 크기 설정 */
		}
		
		.bordered {
		    table-layout: fixed; /* 테이블 레이아웃을 고정으로 설정 */
		    width: 100%; /* 테이블 너비를 100%로 설정 */
		}
		
		/* 첫 번째 td를 수평 및 수직 가운데 정렬 */
		.bordered tbody tr td.align-center {
		    text-align: center; /* 수평 가운데 정렬 */
		    vertical-align: middle;
		    height:50px;
		}
		
		.bordered td{
			border: 1px solid #e8eef3 !important;
		}
		
		.modal-footer{
			border:none !important;
		}
		
		label{
			margin-bottom: 0px !important;
		}
		
		/* 첫 번째, 두 번째, 네 번째 열의 정렬 아이콘을 숨기기 위한 CSS */
		table.dataTable thead th:nth-child(1).sorting:before,
		table.dataTable thead th:nth-child(1).sorting:after,
		table.dataTable thead th:nth-child(1).sorting_asc:before,
		table.dataTable thead th:nth-child(1).sorting_asc:after,
		table.dataTable thead th:nth-child(1).sorting_desc:before,
		table.dataTable thead th:nth-child(1).sorting_desc:after,
		table.dataTable thead th:nth-child(1).sorting_asc_disabled:before,
		table.dataTable thead th:nth-child(1).sorting_asc_disabled:after,
		table.dataTable thead th:nth-child(1).sorting_desc_disabled:before,
		table.dataTable thead th:nth-child(1).sorting_desc_disabled:after,
		table.dataTable thead th:nth-child(2).sorting:before,
		table.dataTable thead th:nth-child(2).sorting:after,
		table.dataTable thead th:nth-child(2).sorting_asc:before,
		table.dataTable thead th:nth-child(2).sorting_asc:after,
		table.dataTable thead th:nth-child(2).sorting_desc:before,
		table.dataTable thead th:nth-child(2).sorting_desc:after,
		table.dataTable thead th:nth-child(2).sorting_asc_disabled:before,
		table.dataTable thead th:nth-child(2).sorting_asc_disabled:after,
		table.dataTable thead th:nth-child(2).sorting_desc_disabled:before,
		table.dataTable thead th:nth-child(2).sorting_desc_disabled:after,
		table.dataTable thead th:nth-child(4).sorting:before,
		table.dataTable thead th:nth-child(4).sorting:after,
		table.dataTable thead th:nth-child(4).sorting_asc:before,
		table.dataTable thead th:nth-child(4).sorting_asc:after,
		table.dataTable thead th:nth-child(4).sorting_desc:before,
		table.dataTable thead th:nth-child(4).sorting_desc:after,
		table.dataTable thead th:nth-child(4).sorting_asc_disabled:before,
		table.dataTable thead th:nth-child(4).sorting_asc_disabled:after,
		table.dataTable thead th:nth-child(4).sorting_desc_disabled:before,
		table.dataTable thead th:nth-child(4).sorting_desc_disabled:after {
		  content: "" !important;
		  width: 0 !important;
		  height: 0 !important;
		  margin: 0 !important;
		  padding: 0 !important;
		  border: none !important;
		}
		
		/* 첫 번째, 두 번째, 네 번째 열에 추가 패딩 */
		table.dataTable thead th:nth-child(1),
		table.dataTable thead th:nth-child(2),
		table.dataTable thead th:nth-child(4) {
		  padding-right: 16px !important;
		}
		
		/* th의 텍스트와 아이콘을 가운데 정렬하고 함께 붙이기 */
		table.dataTable thead th {
		  text-align: center; /* 텍스트와 아이콘을 가운데 정렬 */
		  position: relative; /* 아이콘 위치를 상대적으로 설정 */
		  padding-right: 20px; /* 오른쪽 패딩을 조정하여 아이콘 간격 조절 */
		}
		
		table.dataTable tbody tr {
			text-align: center; /* 텍스트와 아이콘을 가운데 정렬 */
		}
		
		/* 정렬 아이콘의 위치 및 정렬 설정 */
		table.dataTable thead .sorting:before,
		table.dataTable thead .sorting:after,
		table.dataTable thead .sorting_asc:before,
		table.dataTable thead .sorting_asc:after,
		table.dataTable thead .sorting_desc:before,
		table.dataTable thead .sorting_desc:after,
		table.dataTable thead .sorting_asc_disabled:before,
		table.dataTable thead .sorting_asc_disabled:after,
		table.dataTable thead .sorting_desc_disabled:before,
		table.dataTable thead .sorting_desc_disabled:after {
		  display: inline-block; /* 아이콘을 인라인 블록으로 설정 */
		  position: relative; /* 아이콘 위치를 텍스트 옆으로 설정 */
		  margin-left: 12px; /* 텍스트와 아이콘 사이의 간격을 조정 */
		  bottom: 0; /* 아이콘을 텍스트 높이에 맞추기 위해 위치 설정 */
		  opacity: 0.7; /* 아이콘의 불투명도 설정 */
		  content: ''; /* 정렬 아이콘을 CSS로 설정 */
		}
		
		table.dataTable thead .sorting:after,
		table.dataTable thead .sorting_asc:after,
		table.dataTable thead .sorting_desc:after,
		table.dataTable thead .sorting_asc_disabled:after,
		table.dataTable thead .sorting_desc_disabled:after {
		  content: "\25BC"; /* 아래쪽 화살표 */
		}
		
		/* 정렬 아이콘 활성화 시 스타일 */
		table.dataTable thead .sorting_asc:after {
		  content: "\25B2"; /* 위쪽 삼각형 화살표 */
		}
		
		table.dataTable thead .sorting_desc:after {
		  content: "\25BC"; /* 아래쪽 삼각형 화살표 */
		}
		
		div.dataTables_wrapper div.dataTables_length label {
			display: none !important; /* datatables_length를 숨김 */
		}
		
		.bordered tbody tr td.align-center {
		    text-align: center; /* 수평 가운데 정렬 */
		    vertical-align: middle;
		    height:50px;
		}
		
		#move_folder_list .jstree-anchor {
		    margin-bottom: 10px;
		}
    </style>
</head>
<th:block layout:fragment="content">
<body>
	<div class="page-wrapper">
		<div class="container-fluid" style="margin-bottom:-10px;">

               <div class="row">
			    <div class="col-12">
			        <div class="card">
			            <div class="card-body" style="padding:50px 80px">
			                <div class="row" style="margin-left:0px !important; margin-right:0px !important; padding-bottom: 20px; display:flex; align-items: center;">
			                    <div class="col d-flex align-items-center" style="padding-left:0px;">
								    <button type="button" class="btn btn-primary public-btn active" id="public-button">공용문서함</button>
								    <button type="button" class="btn btn-light public-btn" id="private-button" style="margin-left:15px;">개인문서함</button>
			                    </div>
			                </div>
	                        <div class="row" style="margin-left:0px !important; margin-right:0px !important; margin-top:10px;">
			                    <div class="col d-flex justify-content-start align-items-center" style="padding-left:0px; max-width:300px;">
			                    	<img src="/assets/images/yellow_folder_icon.png" alt="폴더 이미지" style="width:35px; height:35px; vertical-align:middle; margin-right:12px;">
			                        <div style="font-size:30px;">공용업무 폴더</div>
			                    </div>		                        
                            	<div class="col d-flex justify-content-end" style="padding-right:0px !important;">
			                        <button type="button" id="uploadButton" style="width:72px; height:45px;" class="btn waves-effect waves-light btn-outline-secondary m-1" data-toggle="modal" data-target="#fileUploadModal">업로드</button>
			                        <button type="button" style="width:72px; height:45px;" class="btn waves-effect waves-light btn-outline-secondary m-1" data-toggle="modal" data-target="#folderCreateModal">새폴더</button>
			                        <button type="button" style="width:72px; height:45px;" class="btn waves-effect waves-light btn-outline-secondary m-1" id="moveButton">이동</button>                            	
			                        <button type="button" style="width:72px; height:45px;" class="btn waves-effect waves-light btn-outline-secondary m-1" id="deleteButton">삭제</button>                   	
                            	</div>							
							</div>
							<div class="table-responsive mt-2">
                                <table id="file_config" class="table table-hover table-bordered no-wrap" style="width:100%">
		                            <thead>
		                                <tr>
											<th scope="col" class="checkbox-cell"><input type="checkbox" id="selectAllCheckbox"></th>
											<th scope="col">종류</th>
											<th scope="col">폴더/파일명</th>
											<th scope="col">크기</th>
											<th scope="col">등록자</th>
											<th scope="col">등록일</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
									</tbody>
                               </table>
                            </div>
                            
                            <!-- 파일 업로드 모달 HTML -->
							<div class="modal fade" id="fileUploadModal" tabindex="-1"
								role="dialog" aria-labelledby="fileUploadModalLabel">
								<div
									class="modal-dialog modal-dialog-centered custom-modal-size"
									style="max-width: 50%; width: 50%; height: 93%;">
									<div class="modal-content" style="height: 93%;">
										<div class="modal-header modal-colored-header bg-primary"
											style="display: flex; align-items: center; justify-content: space-between; font-size: 25px;">
											<div class="modal-title" id="fileUploadModalLabel">
												<i data-feather="file" class="svg-icon mr-2 ml-1"></i>
												파일 업로드
											</div>
											<button type="button" class="close" data-dismiss="modal" onclick="uploadFileResetModal()">
												<i data-feather="x" class="svg-icon mr-2 ml-1"></i>
											</button>
										</div>
										<form id="fileUploadFrm">
											<div class="modal-body" style="padding-left:20px !important; padding-right:20px !important;
											padding-top:20px !important; padding-bottom:0px !important;">
												<input type="hidden" id="csrf_token" th:value="${_csrf.token}">
												 <input type="hidden" id="folder_no"> <!-- 폴더 번호 -->
										        <!-- 안내 메시지 박스 -->
										        <div style="width:100%; background-color:#F6F6F6; padding: 20px;">
													<!-- 아이콘 및 메시지 테이블 -->
												    <table style="width: 100%; border-collapse: collapse;">
												        <tr style="height: 35px;">
												            <td style="width: 30px; vertical-align: top;">
												                <img src="/assets/images/warning.png" alt="경고 아이콘" style="width: 20px; height: 20px;">
												            </td>
												            <td style="vertical-align: top;">
												                여러 개의 파일을 등록하는 경우 몇 번에 나누어서 등록하시기 바랍니다. (3개 이하 권장)
												            </td>
												        </tr>
												        <tr style="height: 35px;">
												            <td style="width: 30px; vertical-align: top;">
												                <img src="/assets/images/warning.png" alt="경고 아이콘" style="width: 20px; height: 20px;">
												            </td>
												            <td style="vertical-align: top;">
												                한 번에 올릴 수 있는 파일 용량은 30MB 입니다.
												            </td>
												        </tr>
												        <tr style="height: 35px;">
												            <td style="width: 30px; vertical-align: top;">
												                <img src="/assets/images/warning.png" alt="경고 아이콘" style="width: 20px; height: 20px;">
												            </td>
												            <td style="vertical-align: top;">
												                타인의 명예를 훼손하거나 지적재산을 침해하는 파일 또는 청소년 유해매체물 등 위법한 게시물은 업로드할 경우 형사처벌, 손해배상 청구 및 계정해지 등을 받을 수 있으니 올바른 서비스 이용 부탁드립니다.
												            </td>
												        </tr>
												    </table>
										        </div>
										        <div id="dropzone" style="border: 2px dashed #ccc; padding: 40px; text-align: center; margin-top:20px;">
													이곳에 파일을 드래그하세요.
												</div>   	
												<table style="border-bottom: none; border-top: none; margin-top:20px !important; margin-bottom:0px !important;" class="table bordered">
													<tbody id="fileUploadContent">
														<!-- 폴더위치 -->
														<tr>
															<td class="align-center" style="width: 20%;"><label>폴더위치</label>
															</td>
															<td style="width: 80%;" id="folderPath">
															
															</td>
														</tr>

														<!-- 첨부파일 -->
														<tr>
														    <td class="align-center" style="width: 20%;"><label>첨부파일</label></td>
														    <td style="width: 80%; padding: 0;">
														        <div style="width: 100%; height: 100%; box-sizing: border-box;">
													                <table style="width: 100%;">
																        <thead>
																            <tr>
																                <th style="text-align: left; vertical-align: middle; width: 75%; border-left:none !important; border-right:none !important; border-top:none !important; border-bottom: 1px solid #e8eef3">파일명</th>
																                <th style="text-align: center; vertical-align: middle; width: 25%; border-left:none !important; border-right:none !important; border-top:none !important; border-bottom: 1px solid #e8eef3">크기</th>
																            </tr>
																        </thead>
																        <tbody id="fileTableBody" style="height:169.5px;">
																			<!-- 파일 목록 추가됩니다 -->
																        </tbody>
															    	</table>
														            <!-- 세 번째 줄: 파일 추가 버튼 및 용량 정보 -->
														            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; height:50px; border-top: 1px solid #e8eef3;">
														                <!-- 숨겨진 파일 입력 필드 -->
               															<input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
               															<button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('fileInput').click();">파일 추가</button>
														                <div style="text-align: right; margin-right:20px;" id="fileSizeDisplay">0 B / 30 MB</div>
														            </div>
														        </div>																	
														    </td>
														</tr>

													</tbody>
												</table>
											</div>
											<div class="modal-footer" style="padding-left:20px !important; padding-right:20px !important;
											padding-top:17px !important;">
												<button type="button"
													class="btn waves-effect waves-light btn-outline-secondary"
													data-dismiss="modal" onclick="uploadFileResetModal()">취소</button>
												<button type="submit"
													class="btn waves-effect waves-light btn-primary">등록</button>
											</div>
										</form>
									</div>
								</div>
							</div>
							
							<!-- 새폴더 생성 모달 HTML -->
							<div class="modal fade" id="folderCreateModal" tabindex="-1"
								role="dialog" aria-labelledby="folderCreateModalLabel">
								<div
									class="modal-dialog modal-dialog-centered custom-modal-size"
									style="max-width: 50%; width: 50%; height: 38%;">
									<div class="modal-content" style="height: 38%;">
										<div class="modal-header modal-colored-header bg-primary"
											style="display: flex; align-items: center; justify-content: space-between; font-size: 25px;">
											<div class="modal-title" id="folderCreateModalLabel">
												<i data-feather="folder" class="svg-icon mr-2 ml-1"></i>
												새폴더 생성
											</div>
											<button type="button" class="close" data-dismiss="modal" onclick="folderCreateResetModal()">
												<i data-feather="x" class="svg-icon mr-2 ml-1"></i>
											</button>
										</div>
										<form id="folderCreateFrm">
											<div class="modal-body" style="padding-left:20px !important; padding-right:20px !important;
											padding-top:20px !important; padding-bottom:0px !important;">
												<input type="hidden" id="csrf_token" th:value="${_csrf.token}">
												<input type="hidden" id="folder_no"> <!-- 폴더 번호 -->
											    <table style="width: 100%; margin-bottom:0px !important;" class="table bordered">
											    	<tbody>
												        <tr>
												            <td class="align-center" style="width: 20%;">
												                <label for="parentFolderPath">부모폴더</label>
												            </td>
												            <td style="width: 80%;" id="parentFolderPath">
												                
												            </td>
												        </tr>
												        <tr>
												            <td class="align-center" style="width: 20%;">
												                <label for="folder_name">생성할 폴더명</label>
												            </td>
												            <td style="width: 80%;">
																<input type="text" class="form-control" name="folder_name" id="folder_name" placeholder="생성할 폴더명" maxlength="30">
																<div style="margin-top:10px;"><img src="/assets/images/warning.png" alt="경고 아이콘" style="width: 20px; height: 20px; margin-right:10px;">폴더명에 특수문자를 사용할 수 없습니다. ( !, @, #, $, %, ^, * )</div>
												            </td>
												        </tr>
											        </tbody>
											    </table>
											</div>
											<div class="modal-footer" style="padding-left:20px !important; padding-right:20px !important;
											padding-top:18px !important;">
												<button type="button"
													class="btn waves-effect waves-light btn-outline-secondary"
													data-dismiss="modal" onclick="folderCreateResetModal()">취소</button>
												<button type="submit"
													class="btn waves-effect waves-light btn-primary">생성</button>
											</div>
										</form>
									</div>
								</div>
							</div>
							
							<!-- 이동 모달 -->
							<div class="modal fade" id="moveModal" tabindex="-1"
								role="dialog" aria-labelledby="moveModalLabel">
								<div
									class="modal-dialog modal-dialog-centered custom-modal-size"
									style="max-width: 25%; width: 25%; height: 60%;">
									<div class="modal-content" style="height: 60%;">
										<div class="modal-header modal-colored-header bg-primary"
											style="display: flex; align-items: center; justify-content: space-between; font-size: 25px;">
											<div class="modal-title" id="moveModalLabel">
												<i data-feather="folder" class="svg-icon mr-2 ml-1"></i>
												이동될 대상 폴더 선택
											</div>
											<button type="button" class="close" data-dismiss="modal" onclick="moveResetModal()">
												<i data-feather="x" class="svg-icon mr-2 ml-1"></i>
											</button>
										</div>
										<form id="moveFrm">
										    <div class="modal-body" style="padding-left:20px !important; padding-right:20px !important; padding-top:20px !important; padding-bottom:0px !important;">
										        <input type="hidden" id="csrf_token" th:value="${_csrf.token}">
												<input type="hidden" id="selectedFolderNo"> <!-- 이동할 대상 폴더 번호를 저장할 숨겨진 필드 추가 -->
										        <div style="border:1px solid #e8eef3; max-height: calc(100vh - 250px); height: calc(100vh - 570px); overflow-y: auto;">
										            <div id="move_folder_list" style="padding:20px;">
										                <!-- 폴더 트리 출력 -->
										            </div>                                                     
										        </div>
										    </div>
										    <div class="modal-footer" style="padding-left:20px !important; padding-right:20px !important; padding-top:18px !important;">
										        <button type="button" class="btn waves-effect waves-light btn-outline-secondary" data-dismiss="modal" onclick="moveResetModal()">취소</button>
										        <button type="submit" class="btn waves-effect waves-light btn-primary">이동</button>
										    </div>
										</form>

									</div>
								</div>
							</div>
							
							<!-- 개인문서함으로 복사 모달 -->
							<div class="modal fade" id="copyModal" tabindex="-1"
								role="dialog" aria-labelledby="copyModalLabel">
								<div
									class="modal-dialog modal-dialog-centered custom-modal-size"
									style="max-width: 25%; width: 25%; height: 60%;">
									<div class="modal-content" style="height: 60%;">
										<div class="modal-header modal-colored-header bg-primary"
											style="display: flex; align-items: center; justify-content: space-between; font-size: 25px;">
											<div class="modal-title" id="copyModalLabel">
												<i data-feather="folder" class="svg-icon mr-2 ml-1"></i>
												복사할 대상 폴더 선택
											</div>
											<button type="button" class="close" data-dismiss="modal" onclick="copyResetModal()">
												<i data-feather="x" class="svg-icon mr-2 ml-1"></i>
											</button>
										</div>
										<form id="copyFrm">
										    <div class="modal-body" style="padding-left:20px !important; padding-right:20px !important; padding-top:20px !important; padding-bottom:0px !important;">
										        <input type="hidden" id="csrf_token" th:value="${_csrf.token}">
												<input type="hidden" id="selectedCopyFolderNo"> <!-- 복사할 대상 폴더 번호를 저장할 숨겨진 필드 추가 -->
										        <div style="border:1px solid #e8eef3; max-height: calc(100vh - 250px); height: calc(100vh - 570px); overflow-y: auto;">
										            <div id="copy_folder_list" style="padding:20px;">
										                <!-- 폴더 트리 출력 -->
										            </div>                                                     
										        </div>
										    </div>
										    <div class="modal-footer" style="padding-left:20px !important; padding-right:20px !important; padding-top:18px !important;">
										        <button type="button" class="btn waves-effect waves-light btn-outline-secondary" data-dismiss="modal" onclick="copyResetModal()">취소</button>
										        <button type="submit" class="btn waves-effect waves-light btn-primary">복사</button>
										    </div>
										</form>

									</div>
								</div>
							</div>
														
			            </div>
			        </div>
			    </div>
			</div>
		</div>
	</div>		            
</body>
	<script>
	
    $(document).ready(function () {
        // 공용문서함 버튼 클릭 이벤트
        $('#public-button').on('click', function () {
            // 기존에 active 클래스가 있는 버튼에서 제거
            $('.public-btn').removeClass('active btn-primary').addClass('btn-light');
            // 현재 클릭된 버튼에 active 클래스 추가
            $(this).removeClass('btn-light').addClass('active btn-primary');
        });

        // 개인문서함 버튼 클릭 이벤트
        $('#private-button').on('click', function () {
            // 기존에 active 클래스가 있는 버튼에서 제거
            $('.public-btn').removeClass('active btn-primary').addClass('btn-light');
            // 현재 클릭된 버튼에 active 클래스 추가
            $(this).removeClass('btn-light').addClass('active btn-primary');
        });

        // 드래그 앤 드롭 이벤트 설정
        const dropzone = document.getElementById('dropzone');
        
        // 드래그 중일 때 스타일을 바꿔주는 이벤트
        dropzone.addEventListener('dragover', function (e) {
            e.preventDefault();
            dropzone.style.backgroundColor = "#F6F6F6"; // 드래그 중일 때 배경색 변경
            dropzone.style.border = "2px dashed #0031AE"; // 테두리 변경
        });

        // 드래그가 끝났을 때 원래 상태로 돌림
        dropzone.addEventListener('dragleave', function (e) {
            e.preventDefault();
            dropzone.style.backgroundColor = ""; // 배경색 복원
            dropzone.style.border = "2px dashed #ccc"; // 테두리 복원
        });

        // 파일을 드롭했을 때 처리하는 이벤트
        dropzone.addEventListener('drop', function (e) {
            e.preventDefault();
            dropzone.style.backgroundColor = ""; // 배경색 복원
            dropzone.style.border = "2px dashed #ccc"; // 테두리 복원

            const files = Array.from(e.dataTransfer.files); // 드롭된 파일 리스트
            processFiles(files); // 파일 처리
        });
    });
    
    $('#move_folder_list').on('select_node.jstree', function(e, data) {
        const folderNo = data.node.id; // 선택된 폴더 번호
        
        // 선택된 폴더 번호를 숨겨진 필드에 저장
        $('#selectedFolderNo').val(folderNo); 
    });
    
    $(document).ready(function() {
        // 폴더 데이터 저장을 위한 객체
        let folderData = {
            publicFolderList: [],
            privateFolderList: []
        };

        // 공용문서함과 개인문서함의 폴더 번호를 미리 정의
        const publicFolderNo = 1; // 공용업무폴더 번호
        const privateFolderNo = 6; // 개인업무폴더 번호

        // 공용문서함 데이터 로드
        fetch('/api/folder-tree')
            .then(response => response.json())
            .then(data => {
                // 공용/개인 문서함 데이터 저장
                folderData.publicFolderList = addIconToItemsRecursively(data.publicFolderList);
                folderData.privateFolderList = addIconToItemsRecursively(data.privateFolderList);

                // 페이지 로드 시 기본적으로 공용문서함 트리 초기화
                initializeTree(folderData.publicFolderList);

                // 공용문서함 버튼 클릭 시 트리 초기화
                $('#public-button').on('click', function() {
                    initializeTree(folderData.publicFolderList);
                });

                // 개인문서함 버튼 클릭 시 트리 초기화
                $('#private-button').on('click', function() {
                    initializeTree(folderData.privateFolderList);
                });
            })
            .catch(error => console.error('Error loading folder tree:', error));

        // 폴더 트리 초기화 함수 (ID를 move_folder_list로 사용)
        function initializeTree(folderData) {
            // 기존 트리 파괴 및 초기화
            $('#move_folder_list').jstree('destroy').empty();

            // jstree 초기화
            $('#move_folder_list').jstree({
                'core': {
                    'data': folderData,
                    'themes': {
                        'icons': true
                    }
                },
                'types': {
                    'default': {
                        'icon': '/assets/images/yellow_folder.png'
                    },
                    'file': {
                        'icon': '/assets/images/yellow_folder.png'
                    }
                }
            }).on('ready.jstree', function() {
                let tree = $('#move_folder_list').jstree(true);
                // 모든 폴더를 펼침
                tree.open_all();
                
            }).on('select_node.jstree', function(e, data) {
                const folderNo = data.node.id;
                updateFolderName(data.node.text); // 폴더 이름 업데이트
                updateFolderPath(data.node); // 폴더 경로 업데이트

                // 서버에 선택된 폴더 번호를 전송할 준비
                $('#selectedFolderNo').val(folderNo); // 폴더 번호를 숨겨진 input에 저장
            });
        }

        // 폴더 아이콘 추가 함수 (재귀적으로 호출)
        function addIconToItemsRecursively(items) {
            return items.map(item => {
                const updatedItem = {
                    ...item,
                    icon: '/assets/images/yellow_folder.png'
                };
                if (item.children && item.children.length > 0) {
                    updatedItem.children = addIconToItemsRecursively(item.children);
                }
                return updatedItem;
            });
        }

        // 폴더 경로 업데이트 함수
        function updateFolderPath(node) {
            let tree = $('#move_folder_list').jstree(true);
            let path = tree.get_path(node, ' > ');  // 최상위 폴더까지 경로 가져오기
            $('#folderPath').text(path); // 경로를 표시할 위치에 업데이트
        }

        // 폴더 이름 업데이트 함수
        function updateFolderName(folderName) {
            $('#selectedFolderName').text(folderName); // 선택된 폴더명을 업데이트
        }

        // 특정 깊이까지 노드 열기 함수
        function openNodeToDepth(tree, node, maxDepth, currentDepth = 1) {
            if (currentDepth < maxDepth) {
                tree.open_node(node, function() {
                    if (tree.get_node(node).children.length > 0) {
                        tree.get_node(node).children.forEach(function(childNode) {
                            openNodeToDepth(tree, childNode, maxDepth, currentDepth + 1);
                        });
                    }
                });
            }
        }
    });

 	// 이동 버튼 클릭 시 로직
    $('#moveButton').on('click', function() {
        const selectedFileNos = [];  // 파일 번호를 저장할 배열
        const selectedFolderNos = [];  // 폴더 번호를 저장할 배열
        const csrfToken = $('#csrf_token').val();
        const targetFolderNo = $('#selectedFolderNo').val(); // 이동될 대상 폴더 번호
        
        // 체크된 폴더 및 파일 항목의 value 값 가져오기
        $('.folderAndFileCheckbox:checked').each(function() {
            const value = $(this).val();

            // 'file_'로 시작하는 경우 파일, 'folder_'로 시작하는 경우 폴더로 구분
            if (value.startsWith('file_')) {
                selectedFileNos.push(value.replace('file_', ''));  // 'file_' 제거 후 번호 저장
            } else if (value.startsWith('folder_')) {
                selectedFolderNos.push(value.replace('folder_', ''));  // 'folder_' 제거 후 번호 저장
            }
        });

        // 체크박스가 선택되지 않았을 때 경고 메시지 표시
        if (selectedFileNos.length === 0 && selectedFolderNos.length === 0) {
            showAlert('warning', '경고', '이동할 폴더나 파일을 선택해주세요!');
            return;
        }

        // 파일이나 폴더가 선택된 경우에만 모달창을 보여줌
        $('#moveModal').modal('show');

        // 모달 내에서 이동 버튼 클릭 시 폴더 선택 여부 확인 및 서버 전송
        $('#moveFrm').on('submit', function(e) {
            e.preventDefault();

            // 폴더 선택이 안 된 경우 경고 메시지 표시
            const targetFolderNo = $('#selectedFolderNo').val(); // 이동될 대상 폴더 번호
            if (!targetFolderNo) {
                showAlert('warning', '경고', '이동될 대상 폴더를 선택해주세요!');
                return;
            }

            // 이동 확인 메시지
            Swal.fire({
                title: '이동하시겠습니까?',
                text: '선택된 폴더나 파일이 이동됩니다.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#5f76e8',
                cancelButtonColor: '#e8eaec',
                confirmButtonText: '이동',
                cancelButtonText: '취소',
                customClass: {
                    cancelButton: 'custom-cancel-button'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // 서버로 이동 요청 전송
                    fetch('/file', {
                        method: 'PUT', 
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-TOKEN': csrfToken
                        },
                        body: JSON.stringify({
                            targetFolderNo: targetFolderNo,
                            fileNos: selectedFileNos,
                            folderNos: selectedFolderNos
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('이동 요청 실패');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 서버로부터 받은 결과 처리
                        if (data.file_res_code === '200' || data.folder_res_code === '200') {
                            showAlert('success', '성공', '선택한 폴더나 파일이 성공적으로 이동되었습니다.', () => location.reload());
                        } else {
                            showAlert('error', '실패', '이동 중 오류가 발생했습니다.');
                        }
                    })
                    .catch(error => {
                        console.error('이동 오류:', error);
                        showAlert('error', '실패', '이동 중 오류가 발생했습니다.');
                    });
                }
            });
        });
    });
 	
    function moveResetModal() {
        // 선택된 폴더 번호 초기화
        $('#selectedFolderNo').val(''); // 숨겨진 input 필드 값 초기화
        
        // jstree에서 선택된 노드 해제
        let tree = $('#move_folder_list').jstree(true);
        if (tree) {
            tree.deselect_all(); // 선택된 모든 노드 해제
        }
        
        // 모달 창 닫기
        $('#moveModal').modal('hide'); // 강제로 모달 창을 닫음
    }
    
	function copyResetModal() {
	    // 선택된 폴더 번호 초기화
	    $('#selectedCopyFolderNo').val(''); // 숨겨진 input 필드 값 초기화
	    
	    // jstree에서 선택된 노드 해제
	    let tree = $('#copy_folder_list').jstree(true);
	    if (tree) {
	        tree.deselect_all(); // 선택된 모든 노드 해제
	    }
	    
	    // 모달 창 닫기
	    $('#copyModal').modal('hide'); // 강제로 모달 창을 닫음
	}

    let totalFileSize = 0; // 전체 파일 크기를 저장하는 변수
    let maxFiles = 3; // 파일 최대 개수 설정
    let addedFiles = []; // 추가된 파일을 저장할 배열
    const fileTableBody = document.getElementById('fileTableBody');
    const fileSizeDisplay = document.getElementById('fileSizeDisplay');
    const dropzone = document.getElementById('dropzone');

    // 파일 선택 시 처리하는 함수
    function handleFileSelect(event) {
        const files = Array.from(event.target.files); // 선택된 파일 리스트
        processFiles(files);
    }

    // 파일 처리 함수
    function processFiles(files) {
        if (addedFiles.length + files.length > maxFiles) {
            Swal.fire({
                icon: 'warning',
                title: '경고',
                text: `파일은 최대 ${maxFiles}개까지 추가 가능합니다.`,
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            });
            return;
        }

        // 파일 추가
        addedFiles = [...addedFiles, ...files].slice(0, maxFiles);
        updateFileList(); // 파일 목록 갱신
    }

    // 파일 목록 갱신 함수
    function updateFileList() {
        fileTableBody.innerHTML = ''; // 파일 목록 초기화

        // 파일 목록을 다시 채움
        for (let i = 0; i < maxFiles; i++) {
            let row;
            if (addedFiles[i]) {
                const file = addedFiles[i];
                row = `
                    <tr style="height: 50px;">
                        <td style="text-align: left; vertical-align: middle; border-left:none !important; border-right:none !important; border-top:none !important; border-bottom: none !important;">${file.name}</td>
                        <td style="text-align: center; vertical-align: middle; border-left:none !important; border-right:none !important; border-top:none !important; border-bottom: none !important;">${(file.size / (1024 * 1024)).toFixed(2)} MB</td>
                    </tr>
                `;
            } else {
                // 빈 row 추가 (빈 tr)
                row = `
                    <tr style="height: 50px;">
                        <td colspan="2" style="border-left:none !important; border-right:none !important; border-top:none !important; border-bottom: none !important;"></td>
                    </tr>
                `;
            }
            fileTableBody.innerHTML += row;
        }

        // 파일 크기 표시 업데이트
        const totalSize = addedFiles.reduce((acc, file) => acc + file.size, 0);
        fileSizeDisplay.textContent = `${(totalSize / (1024 * 1024)).toFixed(2)} MB / 30 MB`;
    }

    // 파일 선택 및 폴더 정보와 함께 전송할 준비
    $('#fileUploadFrm').on('submit', function (e) {
        e.preventDefault();

        const folderNo = document.getElementById('folder_no').value; // 선택된 폴더 번호
        console.log(folderNo);

        if (addedFiles.length === 0) {
            Swal.fire({
                icon: 'warning',
                title: '경고',
                text: '파일을 선택해주세요.',
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            });
            return false;
        }

        const formData = new FormData();
        formData.append('folder_no', folderNo); // 폴더번호 추가
        
        console.log(addedFiles.length);

        // 추가된 파일들을 formData에 추가
        for (let i = 0; i < addedFiles.length; i++) {
            const file = addedFiles[i];
            formData.append('files', file);
        }

        fetch('/file', {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': document.getElementById('csrf_token').value
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => handleResponse(data, "등록"))
        .catch(error => console.error('등록 오류:', error));
    });
    
    // 특수문자를 막는 정규 표현식
    const specialCharPattern = /[!@#$%^*]/;
    
    $('#folderCreateFrm').on('submit', function (e) {
        e.preventDefault();

        const folderNo = document.getElementById('folder_no').value; // 선택된 폴더 번호
        const folderNameInput = document.getElementById('folder_name').value.trim();
        
        // 특수문자 검사
        if (specialCharPattern.test(folderNameInput)) {
            Swal.fire({
                icon: 'warning',
                title: '경고',
                html: '폴더명에 특수문자를 사용할 수 없습니다.<br><br>( !, @, #, $, %, ^, * )',
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            });
            return false; // 유효성 검사 실패
        }
        
        // 폴더명이 비어 있는지 검사
        if (folderNameInput === '') {
            Swal.fire({
                icon: 'warning',
                title: '경고',
                text: '폴더명을 입력해주세요.',
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            });
            return false; // 유효성 검사 실패
        }
        
        // 폴더명과 폴더 번호를 서버로 전송
        fetch('/folder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.getElementById('csrf_token').value // CSRF 토큰 추가
            },
            body: JSON.stringify({
                folder_no: folderNo,
                folder_name: folderNameInput
            })
        })
        .then(response => response.json())
        .then(data => handleResponse(data, "생성"))
        .catch(error => console.error('생성 오류:', error));

    });
    
    function folderCreateResetModal() {
        document.getElementById('folder_name').value = ''; // 폴더명 초기화
        document.getElementById('folder_no').value = ''; // 폴더 번호 초기화
    }

    // 공통 함수: API 응답 처리
    function handleResponse(data, action) {
    	
        if (data.res_code === '200') {
            Swal.fire({
                icon: 'success',
                title: '성공',
                text: data.res_msg,
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            }).then(() => {
            	location.href = "/file";
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: '실패',
                text: data.res_msg,
                confirmButtonText: '확인',
                customClass: {
                    confirmButton: 'swal-custom-button'
                }
            });
        }
    }

    // 모달 초기화
    function uploadFileResetModal() {
        $('#fileUploadFrm')[0].reset(); // 폼 리셋
        $('#fileTableBody').html('');   // 파일 목록 초기화
        $('#fileInput').val('');  // 파일 입력 초기화
        $('#folderCreateFrm')[0].reset();
        $('#folder_name').val('');
        fileSizeDisplay.textContent = '0 B / 30 MB'; // 파일 크기 초기화
        addedFiles = [];  // 파일 배열 초기화
        updateFileList(); // 목록을 갱신하여 드래그 영역 복원
    }
    
 	// showAlert 함수 정의
    function showAlert(icon, title, text, callback = null) {
        Swal.fire({
            icon: icon,
            title: title,
            text: text,
            confirmButtonText: '확인',
            customClass: {
                confirmButton: 'swal-custom-button'
            }
        }).then(() => {
            if (callback) callback();
        });
    }
    
    // 체크박스 전체 선택/해제 기능
    $('#selectAllCheckbox').on('click', function() {
        const isChecked = $(this).is(':checked');
        $('.folderAndFileCheckbox').prop('checked', isChecked);
    });

    // 개별 체크박스 클릭 시 전체 선택 체크박스 상태 업데이트
    $(document).on('click', '.folderAndFileCheckbox', function() {
        const totalCheckboxes = $('.folderAndFileCheckbox').length;
        const checkedCheckboxes = $('.folderAndFileCheckbox:checked').length;

        $('#selectAllCheckbox').prop('checked', totalCheckboxes === checkedCheckboxes);
    });
    

 	// 삭제 버튼 클릭 시 선택된 파일 및 폴더 삭제
    $('#deleteButton').on('click', function() {
        const selectedFileNos = [];  // 파일 번호를 저장할 배열
        const selectedFolderNos = [];  // 폴더 번호를 저장할 배열
        const csrfToken = $('#csrf_token').val();
        
        // 체크된 폴더 및 파일 항목의 value 값 가져오기
        $('.folderAndFileCheckbox:checked').each(function() {
            const value = $(this).val();

            // 'file_'로 시작하는 경우 파일, 'folder_'로 시작하는 경우 폴더로 구분
            if (value.startsWith('file_')) {
                selectedFileNos.push(value.replace('file_', ''));  // 'file_' 제거 후 번호 저장
            } else if (value.startsWith('folder_')) {
                selectedFolderNos.push(value.replace('folder_', ''));  // 'folder_' 제거 후 번호 저장
            }
        });

        // 아무 항목도 선택되지 않았을 때 경고 메시지 표시
        if (selectedFileNos.length === 0 && selectedFolderNos.length === 0) {
            showAlert('warning', '경고', '삭제할 폴더나 파일을 선택해주세요!');
            return;
        }

        // 삭제 확인 메시지
        Swal.fire({
            title: '삭제하시겠습니까?',
            text: '선택된 폴더나 파일이 삭제됩니다.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#5f76e8',
            cancelButtonColor: '#e8eaec',
            confirmButtonText: '삭제',
            cancelButtonText: '취소',
            customClass: {
                cancelButton: 'custom-cancel-button'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                // fetch를 사용하여 삭제 요청
                fetch('/file', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': csrfToken  // CSRF 토큰을 헤더에 추가
                    },
                    body: JSON.stringify({
                        fileNos: selectedFileNos,
                        folderNos: selectedFolderNos
                    })  // 파일 번호와 폴더 번호를 JSON으로 전송
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('삭제 요청 실패');
                    }
                    return response.json();
                })
                .then(data => {
                    // 서버로부터 받은 결과 처리
                    if (data.file_res_code === '200' || data.folder_res_code === '200') {
                        showAlert('success', '성공', '선택한 폴더나 파일이 삭제되었습니다.', () => location.reload());
                    } else {
                        showAlert('error', '실패', '삭제 중 오류가 발생했습니다.');
                    }
                })
                .catch(error => {
                    console.error('삭제 오류:', error);
                    showAlert('error', '실패', '삭제 중 오류가 발생했습니다.');
                });
            }
        });
    });
</script>



    <!-- All Jquery -->
    <!-- ============================================================== -->
    <script src="/assets/libs/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="/assets/libs/popper.js/dist/umd/popper.min.js"></script>
    <script src="/assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- apps -->
    <!-- apps -->
    <script src="/dist/js/app-style-switcher.js"></script>
    <script src="/dist/js/feather.min.js"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
    <script src="/assets/extra-libs/sparkline/sparkline.js"></script>
    <!--Wave Effects -->
    <!-- themejs -->
    <!--Menu sidebar -->
    <script src="/dist/js/sidebarmenu.js"></script>
    <!--Custom JavaScript -->
    <script src="/dist/js/custom.min.js"></script>
    <!--This page plugins -->
    <script src="/assets/extra-libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="/dist/js/pages/datatable/datatable-basic.init.js"></script>
</th:block>
</html>